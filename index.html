<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharos Testnet PHRS-USDC Swap</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button, input { margin: 10px; padding: 10px; }
        #swapList { width: 300px; height: 100px; }
    </style>
</head>
<body>
    <h1>PHRS to USDC Swap on Pharos Testnet</h1>
    <button id="connectWallet">Connect Wallet</button>
    <p>Connected Account: <span id="account"></span></p>
    <label for="swapList">Enter Swap Amounts (PHRS, one per line):</label><br>
    <textarea id="swapList" placeholder="1.5\n2.0\n0.5"></textarea><br>
    <button id="swapButton" disabled>Execute Swaps</button>
    <p id="status"></p>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/4.8.0/web3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.13.2/ethers.umd.min.js"></script>
    <script>
        // Pharos Testnet configuration
        const pharosTestnet = {
            chainId: '0x1EAF', // Example Chain ID (replace with actual Pharos Testnet Chain ID)
            chainName: 'Pharos Testnet',
            nativeCurrency: { name: 'PHRS', symbol: 'PHRS', decimals: 18 },
            rpcUrls: ['https://testnet.dplabs-internal.com'],
            blockExplorerUrls: ['https://explorer.pharosnetwork.xyz']
        };

        // DEX contract addresses (replace with actual Pharos Testnet DEX addresses)
        const ROUTER_ADDRESS = '0x...'; // e.g., Faroswap Router
        const PHRS_ADDRESS = '0x76aaada469d23216be5f7c596fa25f282ff9b364'; // PHRS token contract
        const USDC_ADDRESS = '0xAD902CF99C2dE2f1Ba5ec4D642Fd7E49cae9EE37'; // USDC token contract

        // Uniswap V2 Router ABI (simplified)
        const ROUTER_ABI = [
            'function swapExactTokensForTokens(uint amountIn, uint amountOutMin, address[] path, address to, uint deadline) returns (uint[] amounts)'
        ];
        const ERC20_ABI = [
            'function approve(address spender, uint256 amount) public returns (bool)'
        ];

        let web3, provider, signer, account;

        // Connect Wallet
        document.getElementById('connectWallet').onclick = async () => {
            if (window.ethereum) {
                try {
                    // Request account access
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    web3 = new Web3(window.ethereum);
                    provider = new ethers.BrowserProvider(window.ethereum);
                    signer = await provider.getSigner();
                    account = await signer.getAddress();
                    document.getElementById('account').innerText = account;

                    // Switch to Pharos Testnet
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: pharosTestnet.chainId }]
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [pharosTestnet]
                            });
                        }
                    }
                    document.getElementById('swapButton').disabled = false;
                    updateStatus('Wallet connected and network set to Pharos Testnet');
                } catch (error) {
                    updateStatus(`Error: ${error.message}`);
                }
            } else {
                updateStatus('Please install MetaMask or Rabby Wallet');
            }
        };

        // Execute Multiple Swaps
        document.getElementById('swapButton').onclick = async () => {
            const amounts = document.getElementById('swapList').value.split('\n').filter(a => a.trim());
            if (amounts.length === 0) {
                updateStatus('Please enter at least one swap amount');
                return;
            }

            try {
                const router = new ethers.Contract(ROUTER_ADDRESS, ROUTER_ABI, signer);
                const phrsContract = new ethers.Contract(PHRS_ADDRESS, ERC20_ABI, signer);

                // Approve tokens for each swap
                for (let amount of amounts) {
                    const amountIn = ethers.parseUnits(amount.trim(), 18); // PHRS decimals
                    await phrsContract.approve(ROUTER_ADDRESS, amountIn);
                }

                // Perform swaps
                const deadline = Math.floor(Date.now() / 1000) + 60 * 20; // 20 minutes from now
                const path = [PHRS_ADDRESS, USDC_ADDRESS];
                for (let amount of amounts) {
                    const amountIn = ethers.parseUnits(amount.trim(), 18);
                    const amountOutMin = 0; // Set slippage tolerance as needed
                    const tx = await router.swapExactTokensForTokens(
                        amountIn,
                        amountOutMin,
                        path,
                        account,
                        deadline
                    );
                    updateStatus(`Swap initiated for ${amount} PHRS: ${tx.hash}`);
                    await tx.wait();
                    updateStatus(`Swap completed for ${amount} PHRS`);
                }
            } catch (error) {
                updateStatus(`Error during swap: ${error.message}`);
            }
        };

        function updateStatus(message) {
            document.getElementById('status').innerText = message;
        }
    </script>
</body>
</html>
